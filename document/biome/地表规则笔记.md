## 地表规则笔记

### 地表规则

---

1. "minecraft:bandlands"：用于恶地陶瓦层，没有附加参数
    * ``MaterialRule bandlands = MaterialRules.terracottaBands();``
2. "minecraft:block"：直接替换成其他方块
   * ``MaterialRule block = MaterialRules.block(BlockState blockState);``
3. "minecraft:sequence"：自上而下顺序应用表面规则
   * ``MaterialRule rule = MaterialRules.sequence(MaterialRule... rules);``
   * 非法参数异常：Need at least 1 rule for a sequence（序列至少需要1条表面规则）
   * 理解：序列规则：下层规则的作用效果不会覆盖上层规则的作用效果，而是上层结果会覆盖下层规则
4. "minecraft:condition"：满足一定条件后才执行表面规则
   * ``MaterialRule condition(MaterialCondition condition, MaterialRule rule)``

### 地表条件

---

1. "minecraft:above_preliminary_surface"：检测方块是否高于预处理地表，没有附加参数
   * ``MaterialCondition surface = MaterialRules.surface();``
   * 理解：如果测试成功后，则在世界（生态群系）最表面的上层方块被替换指定方块。如果测试失败，则地下大洞穴的方块不起作用
   * 示例：``MaterialRules.sequence(MaterialRules.condition(MaterialRules.surface(), ModMaterialRuleBlocks.GRASS_BLOCK));`` // 将地表方块替换成草方块，且对地下洞穴无影响
2. "minecraft:temperature"：检测方块坐标温度是否足够低，没有附加参数
   * ``MaterialCondition temperature = MaterialRules.temperature();``
3. "minecraft:steep"：检测方块是否为背阳（朝北或朝东）且高度差大于4格的陡峭斜坡，没有附加参数
   * ``MaterialCondition steep = MaterialRules.steepSlope();``
4. "minecraft:hole"：检测地表厚度是否小于0，没有附加参数
   * ``MaterialCondition hole = MaterialRules.hole();``
5. "minecraft:not"：反转表面规则条件
   * ``MaterialCondition not(MaterialCondition target)``
6. "minecraft:biome"：检测方块是否位于指定的生物群系列表
   * ``MaterialCondition biome(RegistryKey<Biome>... biomes)``
7. "minecraft:vertical_gradient"：向上渐变消失
   * ``verticalGradient(String id, YOffset trueAtAndBelow, YOffset falseAtAndAbove)``
8. "minecraft:noise_threshold"：此XZ坐标Y=0处的噪声值位于指定闭区间内是成功
   * ``noiseThreshold(RegistryKey<NoiseParameters> noise, double min, double max)``

### 其他的地表条件

---

- "minecraft:y_above"：检测方块坐标是否位于指定的坐标上方
  * YOffset anchor：检测方块坐标是否位于指定的坐标上方
  * int runDepthMultiplier：取值范围[-20，20]
  * boolean addStoneDepth：true或false
  * 函数方法01：``MaterialCondition aboveY(YOffset anchor, int runDepthMultiplier)``
  * 函数方法02：``aboveYWithStoneDepth(YOffset anchor, int runDepthMultiplier)``
- "minecraft:water"：检测方块与上方液面的高度是否大于指定值
  * int offset：检测方块的距离
  * int runDepthMultiplier：取值范围[-20，20]
  * boolean addStoneDepth：true或false
  * 函数方法01：``MaterialCondition water(int offset, int runDepthMultiplier)``
  * 函数方法02：``waterWithStoneDepth(int offset, int runDepthMultiplier)``
+ YAbove中的anchor参数
  * 理解：检查方块的坐标是方块下表面的坐标
  * 效果：如果条件是y大于等于0时，将方块替代成指定的方块（例如石头替代成黄绿色羊毛）
+ Water中的offset参数
  * 理解：液体方块的上表面是0，液体方块的下表面是-2，而液体方块自身为-1
  * 例子：设置为-2时，所有方块比-2大的石头（水面上方的0默认是空气，表面规则不对空气起作用）都会测试成功
  * 特殊：设置为-1以及比-1更大的数，只有上方不存在液体方块才会测试成功
+ AddStoneDepth为true时，游戏额外检测“方块的下表面距离正上方的空气下表面之间的、非液体方块”的数量，再加上检测的方块坐标
  * 注意：y_above检测的是大于anchor，water检测的是大于offset的。将add_stone_depth设置为true时会大幅度更改作用范围
+ SurfaceDepthMultiplier：表层厚度的倍数
  * 理解：在应用地表规则时，游戏会使用surface噪声决定表层厚度，将（X,0,Z）处的噪声值 * 2.75 + 3.0 作为表层厚度，而实际表层厚度还受与坐标相关的随机数的影响上下浮动0.25.该噪声与实际表层厚度在原版的地表规则中配合使用
- "minecraft:stone_depth"：设置地表厚度
  * offset：测试成功的方块要小于这个值
  * add_surface_depth：是否要给offset加上表层厚度
  * secondary_depth_range：次级深度范围
  * surface_type：地表类型为floor或ceiling
+ SurfaceType：地表类型参数
  * 若surface_type是floor，自上而下检测。检测的方块的上表面距离正上方第一个空气方块的下表面之间有几个非液体方块
  * 若surface_type是ceiling，自下而上检测。检测的方块的下表面距离正下方第一个空气或液体方块的上表面之间有几个方块

### 参考资料

---

1. [表面规则及参数详解](https://www.bilibili.com/opus/924914365329571909)