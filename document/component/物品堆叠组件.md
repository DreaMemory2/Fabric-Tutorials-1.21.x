### 物品堆叠组件

---

**物品堆叠组件（Item Stack Component）**，又称**物品组件（Item Component）** 或 **数据组件（Data Component）**，是物品数据的保存方式，各种不同的物品堆叠组件共同影响了一个物品的具体行为。

#### 物品存储格式

物品数据可以用于玩家的物品栏和末影箱物品栏、箱子中的物品、物品实体、熔炉方块实体、酿造台方块实体和村民交易内容中。

物品存储有两种方式：
- 带槽位存储：带有字节型Slot标签指定物品所在的槽位，比如在箱子中。
- 不带槽位存储：物品不在槽位中，而是作为某个属性类的数据或配置项，例如物品实体。

物品不仅会存储它的命名空间ID和数量，也会存储物品内部的附加信息，即物品堆叠组件。许多物品并没有这些信息，所以这项为空或不存在。所有物品组件均为可选，但失去部分物品堆叠组件可能使得对应的物品行为产生异常。

物品存储格式如下：
```text
{JSON} 根标签
    {String} id：（命名空间ID）表示某种类的物品堆叠。若未指定，游戏会在加载区块或者生成物品时将其变更为空气。
    {JSON} components：关于当前物品的额外信息，此标签对于多数物品来说都是非必需项。
    {} <物品堆叠组件>：一个物品堆叠组件，标签名称为物品组件的命名空间ID，类型则与对应的物品组件有关。通过命令设置此数据时可以不写命名空间，但在导出时命名空间ID会自行加上``minecraft:``前缀。
    {JSON} !<物品堆叠组件>：存在时，使一个原有的物品堆叠组件失效。此复合标签的内容不影响行为。通过命令设置此数据时可以不写命名空间，但在导出时命名空间ID会自行加上``minecraft:``前缀。
    {Int} count：（0 < 值 ≤ 物品最大堆叠数量）物品的堆叠数。不存在时则默认为1。
```

堆叠物品（Item Stack）的解编码格式（Codec）广泛存在于其他和物品有关的格式中，其源码定义中有许多种类，这里仅介绍几种重要变种：
- 普通解编码：堆叠物品的完整或标准解编码形式，如上文所示
- 单一物品解编码（Single Item Codec）：与普通解编码的最大不同就是其数量被限定为1，所以不存在整型count字段。
- 严格化的普通解编码（Strict Codec）：对普通解编码添加了一个数据验证方法，若验证失败则无法正常开展解编码。验证过程详见下文严格性验证
- 严格化的单一物品解编码（Strict Single Item Codec）：对单一物品解编码添加了一个数据验证方法，若验证失败则无法正常开展解编码。验证过程详见下文严格性验证

#### **严格性验证**

严格性验证分为两步，依次进行，只要其中一个条件不满足则视为验证失败：
+ 对组件的验证：
    * 若物品带有max_damage组件，则物品最大堆叠数（Max Stack Size）不能大于1，否则验证失败。
    * 若物品带有container组件，则代表该物品可作为容器容纳其他物品。要求容器中每个堆叠物品的数量必须小于等于其自身的最大堆叠数，否则验证失败。
+ 对数量的验证：
    * 若堆叠物品的数量大于其最大堆叠数则判定验证失败。

以上，最大堆叠数都通过组件max_stack_size获取，若该组件不存在则视最大堆叠数为1。
